<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0"/>
		<title>政策法规</title>
		<!--jQuery框架-->
		<script src="js/jquery-1.8.3.min.js" type="text/javascript" charset="utf-8"></script>
		<!--MUI框架-->
		<link rel="stylesheet" type="text/css" href="css/mui.min.css"/>
		<script src="js/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<!--CSS-->
		<link rel="stylesheet" type="text/css" href="css/policyAndLaws.css"/>
		<!--JS-->
		<script src="js/jQueryRotate.js" type="text/javascript" charset="utf-8"></script>
	</head>
	
	<body>
		<div class="mainContent">
			<!--回到首页按钮-->
			<div class="backToHome">
				<p><img src="img/backToHome.png"/>首页</p>
			</div>
			<div class="topImg">
				<img src="img/policyTopImg.jpg"/>
			</div>
			<!--政策法规预览建议最多显示44个字-->
			<div class="policyList">
				<div class="policyCell">
					<img src="img/latestNews.png"/>
					<p class="policyTitle">国土资源部关于土地复垦方案编报与备案情况的公示</p>
					<p class="policyDesc">为贯彻落实《土地复垦条例》《土地复垦条例实施办法》，监督检查矿山企业土地复垦义务履行情况...</p>
				</div>
				<div class="policyCell">
					<img src="img/latestNews.png"/>
					<p class="policyTitle">国土资源部关于土地复垦方案编报与备案情况的公示</p>
					<p class="policyDesc">为贯彻落实《土地复垦条例》《土地复垦条例实施办法》，监督检查矿山企业土地复垦义务履行情况...</p>
				</div>
				<div class="policyCell">
					<p class="policyTitle">国土资源部关于土地复垦方案编报与备案情况的公示</p>
					<p class="policyDesc">为贯彻落实《土地复垦条例》《土地复垦条例实施办法》，监督检查矿山企业土地复垦义务履行情况...</p>
				</div>
				<div class="policyCell">
					<p class="policyTitle">国土资源部关于土地复垦方案编报与备案情况的公示</p>
					<p class="policyDesc">为贯彻落实《土地复垦条例》《土地复垦条例实施办法》，监督检查矿山企业土地复垦义务履行情况...</p>
				</div>
				<div class="policyCell">
					<p class="policyTitle">国土资源部关于土地复垦方案编报与备案情况的公示</p>
					<p class="policyDesc">为贯彻落实《土地复垦条例》《土地复垦条例实施办法》，监督检查矿山企业土地复垦义务履行情况...</p>
				</div>
			</div>
			<!--占位DIV-->
			<div class="blankDiv" style="height: 30px;" id="noticeBlankDiv"></div>
			<!--提示加载中DIV-->
			<div class="notice" id="loading">
				<p><img src="img/refresh.png" id="refreshIcon"/>请稍等，加载中...</p>
			</div>
			<!--无更多新闻DIV-->
			<div class="notice" id="notAnymore">
				<p><img src="img/smell.png" id="smell"/>您好，以上是全部公示公告</p>
			</div>
			<!--搜索按钮-->
			<div class="searchIcon">
				<img src="img/search.png"/>
			</div>
		</div>
		
		<script type="text/javascript">
		// 定义屏幕宽高的全局变量
		var windowWidth = 0;
		var windowHeight = 0;
		
		// 页面加载即执行
		$(function(){
			// 获取屏幕的宽高
			windowWidth = $(window).width();
			windowHeight = $(window).height();
			// 刷新图标开始旋转
			var angle = 0;
			setInterval(function(){
				angle+=3;
				$("#refreshIcon").rotate(angle);
			},10);
		});
		
		// 定义所有新闻是否加载完成的标识符
		var allNewsLoaded = 0;
		// 定义是否正在加载新列表项的标识符
		var newsLoading = 0;
		
		// 监听屏幕滑动事件
		$(window).scroll(function(){
			// 获取列表总高度
			var listHeight = $('.policyList').height();
			// 屏幕滑动高度
			var scrollTop = $(document).scrollTop();
			// 滑动总高度
			var totalHeight = parseInt(scrollTop + windowHeight);
			// 美观图片高度
			var imgHeight = $('.topImg').height();
			// 内容总高度
			var contentHeight = parseInt(listHeight + 60 + imgHeight);
			console.log("totalHeight = "+totalHeight);
			console.log("contentHeight = "+contentHeight);
			// 如果屏幕滑动高度+屏幕高度>列表总高度加上其他DIV高度&&新闻没有加载完毕
			if ((totalHeight >= contentHeight) && allNewsLoaded == 0) {
				// 当前是否有加载事件进行
				if (newsLoading == 0) {
					// 修改事件加载标识符，当前有其他加载事件进行中
					newsLoading = 1;
					// 屏幕滑动到底，可以进行上拉加载操作
					console.log("屏幕滑动到底，准备进行上拉加载操作");
					// 隐藏占位DIV，延迟500ms执行
					setTimeout("$('#noticeBlankDiv').css('display','none')",500);
					// 显示加载提示DIV，延迟500ms执行，总共需要1000ms加载
					setTimeout("$('#loading').fadeIn(500);",500);
					// 加载新的列表
					setTimeout("addMoreNews();",1000);
				} else {
					// 当前有其他加载事件进行中，后台输出提示
					console.log("当前有其他加载事件进行中");
				}
			}
		});
		
		function addMoreNews(){
			// 移除原本的占位DIV
			$('#noticeBlankDiv').remove();
			// 将新的列表拼接入原列表中
			$('.policyList').append( // 已解决的问答
				'<div class="policyCell">'+
					'<p class="policyTitle">国土资源部关于土地复垦方案编报与备案情况的公示</p>'+
					'<p class="policyDesc">为贯彻落实《土地复垦条例》《土地复垦条例实施办法》，监督检查矿山企业土地复垦义务履行情况...</p>'+
				'</div>'
			);
			// 隐藏提示DIV
			$('#loading').css('display','none');
			// 添加新的占位DIV
			var newBlankDiv = '<div class="blankDiv" style="height: 30px;" id="noticeBlankDiv"></div>';
			$('.policyList').after(newBlankDiv);
			// 修改事件加载标识符，当前有其他加载事件已完成
			newsLoading = 0;
			// 如果列表已加载完成
			if (1 == 2) {
				// 设置全局标识符以表示新闻已加载完成
				allNewsLoaded = 1;
				// 隐藏占位DIV，延迟500ms执行
				setTimeout("$('#noticeBlankDiv').css('display','none')",500);
				// 显示加载提示DIV，延迟500ms执行，总共需要1000ms加载
				setTimeout("$('#notAnymore').fadeIn(500);",500);
			}
		}
		</script>
	</body>
</html>
