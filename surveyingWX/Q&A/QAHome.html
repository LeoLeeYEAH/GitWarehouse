<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0"/>
		<title>咨询留言</title>
		<!--jQuery框架-->
		<script src="../js/jquery-1.8.3.min.js" type="text/javascript" charset="utf-8"></script>
		<!--MUI框架-->
		<link rel="stylesheet" type="text/css" href="../css/mui.min.css"/>
		<script src="../js/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<!--CSS-->
		<link rel="stylesheet" type="text/css" href="../css/QAHome.css"/>
		<!--JS-->
		<script src="../js/jQueryRotate.js" type="text/javascript" charset="utf-8"></script>
	</head>
	
	<body>
		<div class="mainContent">
			<!--顶部导航栏-->
			<div class="homeAndAsk">
				<div class="home">
					<p><img src="../img/backToHome2.png"/>首页</p>
				</div>
				<div class="ask">
					<p><img src="../img/write.png"/>提问咨询</p>
				</div>
			</div>
			<!--列表栏-->
			<div class="QAList">
				<div class="QACell">
					<p class="title">房屋测绘的收费标准是多少？<span class="done">已解决</span></p>
					<p class="time">2017-12-20</p>
					<p class="desc">你好，我想知道房屋测绘的收费标准是多少？（问题补充，有就显示，没有就不显示，建议最多显示44字）</p>
				</div>
				<div class="QACell">
					<p class="title">房屋测绘的收费标准是多少？<span class="undone">未解决</span></p>
					<p class="time">2017-12-20</p>
					<p class="desc">你好，我想知道房屋测绘的收费标准是多少？（问题补充，有就显示，没有就不显示，建议最多显示44字）</p>
				</div>
				<div class="QACell">
					<p class="title">房屋测绘的收费标准是多少？<span class="done">已解决</span></p>
					<p class="time">2017-12-20</p>
					<p class="desc"></p>
				</div>
				<div class="QACell">
					<p class="title">房屋测绘的收费标准是多少？<span class="done">已解决</span></p>
					<p class="time">2017-12-20</p>
					<p class="desc">你好，我想知道房屋测绘的收费标准是多少？（问题补充，有就显示，没有就不显示，建议最多显示44字）</p>
				</div>
				<div class="QACell">
					<p class="title">房屋测绘的收费标准是多少？<span class="done">已解决</span></p>
					<p class="time">2017-12-20</p>
					<p class="desc"></p>
				</div>
			</div>
			<!--占位DIV-->
			<div class="blankDiv" style="height: 30px;" id="noticeBlankDiv"></div>
			<!--提示加载中DIV-->
			<div class="notice" id="loading">
				<p><img src="../img/refresh.png" id="refreshIcon"/>请稍等，加载中...</p>
			</div>
			<!--无更多新闻DIV-->
			<div class="notice" id="notAnymore">
				<p><img src="../img/smell.png" id="smell"/>您好，以上是全部问答内容</p>
			</div>
			<!--搜索按钮-->
			<div class="searchIcon">
				<img src="../img/search.png"/>
			</div>
		</div>
		
		<script type="text/javascript">
		// 定义屏幕宽高的全局变量
		var windowWidth = 0;
		var windowHeight = 0;
		
		// 页面加载即执行
		$(function(){
			// 获取屏幕的宽高
			windowWidth = $(window).width();
			windowHeight = $(window).height();
			// 刷新图标开始旋转
			var angle = 0;
			setInterval(function(){
				angle+=3;
				$("#refreshIcon").rotate(angle);
			},10);
		});
		
		// 定义所有新闻是否加载完成的标识符
		var allNewsLoaded = 0;
		// 定义是否正在加载新列表项的标识符
		var newsLoading = 0;
		
		// 监听屏幕滑动事件
		$(window).scroll(function(){
			// 获取列表总高度
			var listHeight = $('.QAList').height();
			// 屏幕滑动高度
			var scrollTop = $(document).scrollTop();
			// 滑动总高度
			var totalHeight = parseInt(scrollTop + windowHeight);
			// 内容总高度
			var contentHeight = parseInt(listHeight + 50);
			console.log("totalHeight = "+totalHeight);
			console.log("contentHeight = "+contentHeight);
			// 如果屏幕滑动高度+屏幕高度>列表总高度加上其他DIV高度&&新闻没有加载完毕
			if ((totalHeight >= contentHeight) && allNewsLoaded == 0) {
				// 当前是否有加载事件进行
				if (newsLoading == 0) {
					// 修改事件加载标识符，当前有其他加载事件进行中
					newsLoading = 1;
					// 屏幕滑动到底，可以进行上拉加载操作
					console.log("屏幕滑动到底，准备进行上拉加载操作");
					// 隐藏占位DIV，延迟500ms执行
					setTimeout("$('#noticeBlankDiv').css('display','none')",500);
					// 显示加载提示DIV，延迟500ms执行，总共需要1000ms加载
					setTimeout("$('#loading').fadeIn(500);",500);
					// 加载新的列表
					setTimeout("addMoreNews();",1000);
				} else {
					// 当前有其他加载事件进行中，后台输出提示
					console.log("当前有其他加载事件进行中");
				}
			}
		});
		
		function addMoreNews(){
			// 移除原本的占位DIV
			$('#noticeBlankDiv').remove();
			// 将新的列表拼接入原列表中
			$('.QAList').append( // 已解决的问答
				'<div class="QACell">'+
					'<p class="title">房屋测绘的收费标准是多少？<span class="done">已解决</span></p>'+
					'<p class="time">2017-12-20</p>'+
					'<p class="desc">你好，我想知道房屋测绘的收费标准是多少？（问题补充，有就显示，没有就不显示，建议最多显示44字）</p>'+
				'</div>'
			);
			$('.QAList').append( // 未解决的问答
				'<div class="QACell">'+
					'<p class="title">房屋测绘的收费标准是多少？<span class="undone">未解决</span></p>'+
					'<p class="time">2017-12-20</p>'+
					'<p class="desc">你好，我想知道房屋测绘的收费标准是多少？（问题补充，有就显示，没有就不显示，建议最多显示44字）</p>'+
				'</div>'
			);
			// 隐藏提示DIV
			$('#loading').css('display','none');
			// 添加新的占位DIV
			var newBlankDiv = '<div class="blankDiv" style="height: 30px;" id="noticeBlankDiv"></div>';
			$('.QAList').after(newBlankDiv);
			// 修改事件加载标识符，当前有其他加载事件已完成
			newsLoading = 0;
			// 如果列表已加载完成
			if (1 == 2) {
				// 设置全局标识符以表示新闻已加载完成
				allNewsLoaded = 1;
				// 隐藏占位DIV，延迟500ms执行
				setTimeout("$('#noticeBlankDiv').css('display','none')",500);
				// 显示加载提示DIV，延迟500ms执行，总共需要1000ms加载
				setTimeout("$('#notAnymore').fadeIn(500);",500);
			}
		}
		</script>
	</body>
</html>
