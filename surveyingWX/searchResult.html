<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0"/>
		<title>搜索结果</title>
		<!--jQuery框架-->
		<script src="js/jquery-1.8.3.min.js" type="text/javascript" charset="utf-8"></script>
		<!--MUI框架-->
		<link rel="stylesheet" type="text/css" href="css/mui.min.css"/>
		<script src="js/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<!--CSS-->
		<link rel="stylesheet" type="text/css" href="css/searchResult.css"/>
		<!--JS-->
		<script src="js/jQueryRotate.js" type="text/javascript" charset="utf-8"></script>
	</head>
	
	<body>
		<div class="mainContent">
			<!--搜索栏-->
			<div class="search">
				<div class="searchInput mui-input-row">
					<img src="img/searchGray.png"/><input class="mui-input-clear" type="text" placeholder="搜索"/>
				</div>
				<div class="searchCancel">
					<p>取消</p>
				</div>
			</div>
			<!--分类栏-->
			<div class="category">
				<div class="categoryCell" id="news">
					<p>公示公告</p>
					<div class="blueLine"></div>
					<div class="grayLine"></div>
				</div>
				<div class="categoryCell" id="policy">
					<p>政策法规</p>
					<div class="blueLine"></div>
					<div class="grayLine"></div>
				</div>
				<div class="categoryCell" id="QA">
					<p>咨询留言</p>
					<div class="blueLine"></div>
					<div class="grayLine"></div>
				</div>
				<div class="categoryCell" id="guide">
					<p>办事指南</p>
					<div class="blueLine"></div>
					<div class="grayLine"></div>
				</div>
			</div>
			<!--没有搜索结果时的提示栏-->
			<div class="fullNotice" id="noData">
				<p><img src="img/noData.png"/>抱歉，没有搜索到相关信息</p>
			</div>
			<!--正在搜索时的提示栏-->
			<div class="fullNotice" id="searching">
				<p><img src="img/searching.png"/>搜索中，请稍后</p>
			</div>
			<!--列表栏-->
			<div class="resultList">
				<!--搜索结果预览建议最多显示44个字-->
				<ul class="mui-table-view">
				    <li class="mui-table-view-cell">
				    		<p class="resultTitle">国土资源部关于土地复垦方案编报与备案情况的公示</p>
				    		<p class="resultTime">2017-12-20</p>
				    		<p class="resultDesc">为贯彻落实《土地复垦条例》《土地复垦条例实施办法》，监督检查矿山企业土地复垦义务履行情况...</p>
				    </li>
				    <li class="mui-table-view-cell">
				    		<p class="resultTitle">国家测绘地理信息局举办党员重温入党誓词仪式</p>
				    		<p class="resultTime">2017-12-20</p>
				    		<p class="resultDesc">12月15日，国家测绘地理信息局举办党员重温入党誓词仪式。局党组书记、局长库热西为重温入党...</p>
				    </li>
				    <li class="mui-table-view-cell">
				    		<p class="resultTitle">国家测绘地理信息局组织开展深入学习贯彻党的十九大精神集中轮训</p>
				    		<p class="resultTime">2017-12-20</p>
				    		<p class="resultDesc">为认真贯彻落实《中共中央关于认真学习宣传贯彻党的十九大精神的决定》《中共中央组织部关于...</p>
				    </li>
				    <li class="mui-table-view-cell">
				    		<p class="resultTitle">国土资源部关于土地复垦方案编报与备案情况的公示</p>
				    		<p class="resultTime">2017-12-20</p>
				    		<p class="resultDesc">为贯彻落实《土地复垦条例》《土地复垦条例实施办法》，监督检查矿山企业土地复垦义务履行情况...</p>
				    </li>
				    <li class="mui-table-view-cell">
				    		<p class="resultTitle">国家测绘地理信息局举办党员重温入党誓词仪式</p>
				    		<p class="resultTime">2017-12-20</p>
				    		<p class="resultDesc">12月15日，国家测绘地理信息局举办党员重温入党誓词仪式。局党组书记、局长库热西为重温入党...</p>
				    </li>
				    <li class="mui-table-view-cell">
				    		<p class="resultTitle">国家测绘地理信息局组织开展深入学习贯彻党的十九大精神集中轮训</p>
				    		<p class="resultTime">2017-12-20</p>
				    		<p class="resultDesc">为认真贯彻落实《中共中央关于认真学习宣传贯彻党的十九大精神的决定》《中共中央组织部关于...</p>
				    </li>
				</ul>
			</div>
			<!--占位DIV-->
			<div class="blankDiv" style="height: 30px;" id="noticeBlankDiv"></div>
			<!--提示加载中DIV-->
			<div class="notice" id="loading">
				<p><img src="img/refresh.png" id="refreshIcon"/>请稍等，加载中...</p>
			</div>
			<!--无更多新闻DIV-->
			<div class="notice" id="notAnymore">
				<p><img src="img/smell.png" id="smell"/>您好，以上是全部公示公告</p>
			</div>
		</div>
		
		<script type="text/javascript">
		// 定义一个选中元素的全局变量
		var selectedCategory = null;
		
		// 获取屏幕的宽高
		var windowWidth = $(window).width();
		var windowHeight = $(window).height();
		
		
		$(function(){
			// 刷新图标开始旋转
			var angle = 0;
			setInterval(function(){
				angle+=3;
				$("#refreshIcon").rotate(angle);
			},10);
			// 为全页面提示添加边距样式
			var fullNoticeMT = (windowHeight - 100) / 2;
			$('.fullNotice').css('margin-top',fullNoticeMT + 'px');
			// 页面载入后进行的一系列针对分类栏的操作
			// 对四个分类的显示与隐藏添加class，‘showCell’代表显示，‘hideCell’代表隐藏
			$('#news').addClass('showCell');
			$('#policy').addClass('showCell');
			$('#QA').addClass('showCell');
			$('#guide').addClass('showCell');
			// 获取有数据的分类数量
			var categoryAvailable = $('.showCell').length;
			// 判断搜索结果是否有数据
			if (categoryAvailable > 0) { // 有搜索结果
				// 显示分类栏
				$('.category').css('display','block')
				// 对分类栏的宽度进行调整
				var categoryCellWidth = (1/ categoryAvailable) * windowWidth;
				$('.categoryCell').css('width',categoryCellWidth + 'px');
				// 默认选中当前有数据的第一个分类
				selectedCategory = $('.showCell')[0];
				// 改变样式
				$(selectedCategory).children('.grayLine').css('display','none');
				$(selectedCategory).children('.blueLine').css('display','block');
				// 默认载入
				loadResults();
			} else { // 没有搜索结果
				// 隐藏分类栏
				$('.category').css('display','none');
				// 显示提示
				$('#noData').css('display','block');
			}
		});
		
		// 分类栏目点击事件
		$('.categoryCell').click(function(){
			// 改变之前选中分类的样式
			$(selectedCategory).children('.grayLine').css('display','block');
			$(selectedCategory).children('.blueLine').css('display','none');
			// 点击之后选中该分类
			$(this).children('.grayLine').css('display','none');
			$(this).children('.blueLine').css('display','block');
			// 对全局变量赋值
			selectedCategory = $(this);
			// 清除原有的结果列表
			$('.mui-table-view').empty();
			// 载入新的结果列表
			loadResults();
		});
		
		// 加载数据
		function loadResults(){
			console.log('加载数据');
		}
		
		// 定义所有新闻是否加载完成的标识符
		var allNewsLoaded = 0;
		// 定义是否正在加载新列表项的标识符
		var newsLoading = 0;
		
		// 监听屏幕滑动事件
		$(window).scroll(function(){
			// 获取列表总高度
			var listHeight = $('.mui-table-view').height();
			// 屏幕滑动高度
			var scrollTop = $(document).scrollTop();
			// 滑动总高度
			var totalHeight = parseInt(scrollTop + windowHeight);
			// 内容总高度
			var contentHeight = parseInt(listHeight + 100 + 30);
//			console.log("totalHeight = "+totalHeight);
//			console.log("contentHeight = "+contentHeight);
			// 如果屏幕滑动高度+屏幕高度>列表总高度加上其他DIV高度&&新闻没有加载完毕
			if ((totalHeight >= contentHeight) && allNewsLoaded == 0) {
				// 当前是否有加载事件进行
				if (newsLoading == 0) {
					// 修改事件加载标识符，当前有其他加载事件进行中
					newsLoading = 1;
					// 屏幕滑动到底，可以进行上拉加载操作
					console.log("屏幕滑动到底，准备进行上拉加载操作");
					// 隐藏占位DIV，延迟500ms执行
					setTimeout("$('#noticeBlankDiv').css('display','none')",500);
					// 显示加载提示DIV，延迟500ms执行，总共需要1000ms加载
					setTimeout("$('#loading').fadeIn(500);",500);
					// 加载新的列表
					setTimeout("addMoreNews();",1000);
				} else {
					// 当前有其他加载事件进行中，后台输出提示
					console.log("当前有其他加载事件进行中");
				}
			}
		});
		
		function addMoreNews(){
			// 移除原本的占位DIV
			$('#noticeBlankDiv').remove();
			// 将新的列表拼接入原列表中
			$('.mui-table-view').append( // 示例
				'<li class="mui-table-view-cell">'+
			    		'<p class="resultTitle">国家测绘地理信息局组织开展深入学习贯彻党的十九大精神集中轮训</p>'+
			    		'<p class="resultTime">2017-12-20</p>'+
			    		'<p class="resultDesc">为认真贯彻落实《中共中央关于认真学习宣传贯彻党的十九大精神的决定》《中共中央组织部关于...</p>'+
			    '</li>'
			);
			// 隐藏提示DIV
			$('#loading').css('display','none');
			// 添加新的占位DIV
			var newBlankDiv = '<div class="blankDiv" style="height: 30px;" id="noticeBlankDiv"></div>';
			$('.mui-table-view').after(newBlankDiv);
			// 修改事件加载标识符，当前有其他加载事件已完成
			newsLoading = 0;
			// 如果列表已加载完成
			if (1 == 2) {
				// 设置全局标识符以表示新闻已加载完成
				allNewsLoaded = 1;
				// 隐藏占位DIV，延迟500ms执行
				setTimeout("$('#noticeBlankDiv').css('display','none')",500);
				// 显示加载提示DIV，延迟500ms执行，总共需要1000ms加载
				setTimeout("$('#notAnymore').fadeIn(500);",500);
			}
		}
		</script>
	</body>
</html>
